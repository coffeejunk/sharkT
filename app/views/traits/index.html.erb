<script src="//unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="//unpkg.com/canvas-datagrid/dist/canvas-datagrid.js"></script>

    <h1 class="title">Shark Traits has currently <%= @measurement_count %> measurements of
      <%= @trait_count %> traits, covering <%= @species_count %> species</h1>
    
    <div id="gridctr" style="height: 637px;"></div>
<%= link_to 'Download CSV', '#', id: 'data-export-link' %>

<script>
  /*jshint browser:true */
  /* eslint-env browser */
  /* eslint no-use-before-define:0 */
  /*global Uint8Array, Uint16Array, ArrayBuffer */
  /*global XLSX */

  var data = `<%= @traits.html_safe %>`;
  var wb = XLSX.read(data, {type:"binary"});
  var js = XLSX.utils.sheet_to_json(wb.Sheets.Sheet1, {header:1, raw:true});

  var grid = canvasDatagrid({
    parentNode: document.getElementById('gridctr'),
    editable: false,
    data: js
  });
  grid.style.height = '100%';
  grid.style.width = '100%';

  const date = new Date().toISOString().slice(0,10);
  const fname = 'shark-traits-' + date + '.csv';
  var a = document.getElementById("data-export-link");
  a.onclick = function() {
    XLSX.writeFile(wb, fname)
    return false;
  }
</script>
